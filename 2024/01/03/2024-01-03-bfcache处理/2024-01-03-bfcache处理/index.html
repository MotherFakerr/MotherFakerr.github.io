<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="MotherFaker的个人博客"><title>bfcache处理 | MotherFaker的个人博客</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css"><script src="/js/pace.min.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="MotherFaker的个人博客" type="application/atom+xml">
</head><body><main class="content"><section class="outer"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"><article id="post-2024-01-03-bfcache处理/2024-01-03-bfcache处理" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">bfcache处理</h1></header><div class="article-meta"><a href="/2024/01/03/2024-01-03-bfcache%E5%A4%84%E7%90%86/2024-01-03-bfcache%E5%A4%84%E7%90%86/" class="article-date"><time datetime="2024-01-02T16:15:00.000Z" itemprop="datePublished">2024-01-03</time></a><div class="article-category"><a class="article-category-link" href="/categories/%E6%96%87%E7%AB%A0/">文章</a></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><p>最近业务上遇到个问题：</p><p>项目里有两个app，当页面初始化的时候会跑一段代码codeA将url中的一些参数存储到WebStorage中。</p><p>当从appA跳转到appB，然后使用浏览器自带的返回按钮返回appA时，发现WebStorage中的参数还是appB的参数，也就是appA的初始化时的代码codeA没有跑。</p><p>查询过后发现是触发了浏览器的bfcache机制。</p><span id="more"></span><h1 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h1><p>bfcache全称back/forward cache，是部分浏览器（pc端测试chrome有但是edge没有）为了提升用户体验添加的一项功能。</p><p>bfcache会将页面的所有信息保存在缓存中，包含dom状态以及js堆栈数据。若页面缓存在bfcache中，浏览器在前进后退时会直接取出缓存中的页面信息而不会跑任何常规代码。</p><h1 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h1><p>可以监听页面的pageshow事件，该事件会在页面显示时触发，事件中的persisted为true时表示页面是从缓存中加载的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&#x27;pageshow&#x27;, (e) =&gt; &#123;</span><br><span class="line">    if (e.persisted) &#123;</span><br><span class="line">        // 更新WebStorage中数据</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="https://motherfakerr.github.io/2024/01/03/2024-01-03-bfcache%E5%A4%84%E7%90%86/2024-01-03-bfcache%E5%A4%84%E7%90%86/" data-id="clrq183bh000i0cuo34uwbd58" class="article-share-link">分享</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bfcache/" rel="tag">bfcache</a></li></ul></footer></div><nav class="article-nav"><a href="/2024/01/03/2024-01-03-%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/2024-01-03-%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/" class="article-nav-link"><strong class="article-nav-caption">前一篇</strong><div class="article-nav-title">计算几何</div></a><a href="/2024/01/03/2024-01-03-%E9%A1%B5%E9%9D%A2%E5%8D%B8%E8%BD%BD%E6%97%B6%E5%90%91%E5%90%8E%E7%AB%AF%E5%8F%91%E9%80%81%E6%8E%A5%E5%8F%A3/2024-01-03-%E9%A1%B5%E9%9D%A2%E5%8D%B8%E8%BD%BD%E6%97%B6%E5%90%91%E5%90%8E%E7%AB%AF%E5%8F%91%E9%80%81%E6%8E%A5%E5%8F%A3/" class="article-nav-link"><strong class="article-nav-caption">后一篇</strong><div class="article-nav-title">页面卸载时向后端发送接口</div></a></nav></article></section><footer class="footer"><div class="outer"><ul class="list-inline"><li>MotherFaker的个人博客 &copy; 2024</li><li><a href="https://beian.miit.gov.cn/" target="_blank"></a></li><li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li><li>theme <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li></ul><p></p><ul class="list-inline"><li><i class="fe fe-smile-alt tooltip" data-tooltip="访客量"></i> <span id="busuanzi_value_site_uv"></span></li><li><i class="fe fe-bookmark tooltip" data-tooltip="点击量"></i> <span id="busuanzi_value_page_pv"></span></li></ul><p></p></div></footer></main><aside class="sidebar"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/logo.png" alt="MotherFaker的个人博客"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/">主页</a></li><li class="nav-item"><a class="nav-item-link" href="/categories/%E6%96%87%E7%AB%A0">文章</a></li><li class="nav-item"><a class="nav-item-link" href="/categories/%E7%AC%94%E8%AE%B0">笔记</a></li><li class="nav-item"><a class="nav-item-link" href="/favorites">收藏</a></li><li class="nav-item"><a class="nav-item-link" href="/categories">类别</a></li><li class="nav-item"><a class="nav-item-link" href="/tags">标签</a></li><li class="nav-item"><a class="nav-item-link" href="/about">关于</a></li><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="fe fe-search"></i> 搜索</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><div class="totop" id="totop"><i class="fe fe-rocket"></i></div></li><li class="nav-item"><a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed"><i class="fe fe-feed"></i></a></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.justifiedGallery.min.js"></script><script src="/js/lazyload.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/fancybox/jquery.fancybox.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="/js/ocean.js"></script></body></html>